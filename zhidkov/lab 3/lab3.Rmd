---
title: "Лабораторная работа №3"
author: "Ilya Zhidkov"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Задачи для лабораторной: 
* работа с текстом;
* использование регулярных выражений для извлечения данных;
* переписывание существующего кода;
* ассиметричные распределения.

## Требования к оформлению
* Оформить решение в R Markdown. 
* Сохранить файл в свой репозиторий.
* Выгрузить R Markdown в HTML, назвать своим именем и отправить по почте (если хочется сдать раньше или нужна помощь).

## Исходные данные
Файл _forbes.htm_ содержит список богатейших американцев по версии журнала Форбс.
На его примере потренируемся в разборе html страниц.

### Задание 1
1. Используйте команду ``readLines`` для загрузки файла в текстовый вектор _html_.
```{r}
forbes_data <- readLines('forbes.htm')
```
   1. Сколько строк в файле?
   
```{r}
length(forbes_data)   
```

   2. Сколько символов в файле?
```{r}
sum(nchar((forbes_data)))
```

2. Откройте файл в текстовом редакторе. Найдите строки, содержащие данные о Билле Гейтсе и Ларри Эллисоне и запомните размер их дохода.

```{r}
bill_gates.income <- '$72 B'
larry_ellison.income <- '$41 B'
```

3. Напишите шаблон регулярного выражения и используйте функцию ``grep``, чтобы извлечь размер дохода из данных в векторе _html_.

```{r}
income_pattern <- c("\\$[0-9]{1,},*[1-9]*\\sB")
forbes_data.incomes <- grep(income_pattern, forbes_data)
```

Удостоверьтесь, что полученный вектор номеров строк содержит содержит ровно 100 записей и ссылается на номера строк в котрых действительно есть
информация о доходе, а не просто первый попавшийся текст.

```{r}
length(forbes_data.incomes)
```

4. Напишите код, использовав регулярное выражение из п. 3, и функции ``regexp`` и ``regmatches``, чтобы извлечь все данные о доходе.

```{r}
forbes_data.matches <- regmatches(forbes_data, regexpr(income_pattern, forbes_data))
print(forbes_data.matches)
```

Проверьте следующее:    
   1. Должно быть ровно сто значений.   
   2. Самый большой доход должен быть доход Билла Гейтса    
   3. Такой доход должен быть в списке один раз.    
   4. В всписке должна быть цифра, которую мы запомнили для Ларри Эллисона.   
   5. Должно быть как минимум два значения, встречающихся несколько раз.    

**Ответ**: Все выше перечисленные пункты легко увидеть из вывода полученного вектора значений forbes_data.matches   

### Задание 2
5. В данных доход представлен в формате **"$42 B"**, что означает **42 × 10^9**.
Преобразуйте этот формат в числовой и сохраните в вектор _worths_.    

```{r}
forbes_data.matches.new <- gsub(',', '\\.', forbes_data.matches)
pattern.new <- '[0-9]{1,}\\.*[1-9]*'
worths <- as.double(regmatches(forbes_data.matches.new, regexpr(pattern.new,forbes_data.matches.new)))*10^9
print(worths)
```

Удостоверьтесь в следующем:
   1. _worths_ является вектором и в нём сто занчений типа _double_.
   2. Все элементы вектора _worths_ больше 1 миллиарда.
   3. Самое большое число это доход Билла Гейтса.
   
6. Используйте вектор _worths_ , чтобы выяснить следующее:
   1. Какова медиана ста этих записей?
```{r}
df = as.data.frame(worths)
median(df[['worths']])
```

   2. Средний доход?
```{r}
mean(df[['worths']])
```
   3. Как много людей из этого списка имеют доход больше 5млрд., 10, 25? 
```{r}
length(df[df['worths'] > 5e+9, ])
length(df[df['worths'] > 10e+9, ])
length(df[df['worths'] > 25e+9, ])
```
   4. Какой их общий доход?
```{r}
sum(df[['worths']])
```
   5. Какую долю от общего дохода, составляет пятёрка самых богатых.
```{r}
print(five_richest_share <- sum(df[1:5, 'worths'])/sum(df[['worths']]))
```
   6. Какую долю от общего дохода, составляют 20 самых богатых.
```{r}
print(twenty_richest_share <- sum(df[1:20, 'worths'])/sum(df[['worths']]))
```
   7. В данных [федерального резерва США](https://www.federalreserve.gov/releases/z1/current/z1.pdf) найдите
   показатель дохода всех домохозяйств (Household net worth) в соответвующем году, какую долю
   общего дохода составляют 100 богатейших людей. 
   
```{r}
print(96.196e+9/sum(df[['worths']]))
```